
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Refactoring Diff</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.7.1/styles/github.min.css" />
    <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/diff2html/bundles/css/diff2html.min.css" />
    <style>
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; padding: 20px; }
        h2 { color: #333; }
    </style>
</head>
<body>
    <h2>üïµÔ∏è Refactoring Diff Report</h2>
    <div id="diff_result"></div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/jsdiff/5.0.0/diff.min.js"></script>
    <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/diff2html/bundles/js/diff2html-ui.min.js"></script>
    <script>
        const oldCode = `# BAD CODE SNIPPET
total_amount = 0
user_id = "user_123"

def validate_user():
    global user_id
    if user_id:
        print("User is valid")
        return True
    return False

def process_payment(amount):
    global total_amount
    if validate_user():
        total_amount += amount
        print(f"Charged {amount}. New Total: {total_amount}")

if __name__ == "__main__":
    process_payment(100.50)
    process_payment(50.00)`;
        const newCode = `\`\`\`python
from typing import Optional

class UserValidator:
    def __init__(self, user_id: str):
        self.user_id = user_id

    def validate_user(self) -> bool:
        if self.user_id:
            print("User is valid")
            return True
        return False

class PaymentProcessor:
    def __init__(self, user_validator: UserValidator):
        self.user_validator = user_validator
        self.total_amount = 0.0

    def process_payment(self, amount: float) -> None:
        if self.user_validator.validate_user():
            self.total_amount += amount
            print(f"Charged {amount}. New Total: {self.total_amount}")

if __name__ == "__main__":
    user_validator = UserValidator("user_123")
    payment_processor = PaymentProcessor(user_validator)
    payment_processor.process_payment(100.50)
    payment_processor.process_payment(50.00)
\`\`\``;
        
        document.addEventListener('DOMContentLoaded', () => {
            const diffString = Diff.createTwoFilesPatch("Original", "Refactored", oldCode, newCode);
            const targetElement = document.getElementById('diff_result');
            const configuration = {
                drawFileList: false,
                fileListToggle: false,
                fileListStartVisible: false,
                fileContentToggle: false,
                matching: 'lines',
                outputFormat: 'side-by-side',
                synchronisedScroll: true,
                highlight: true,
                renderNothingWhenEmpty: false,
            };
            const diff2htmlUi = new Diff2HtmlUI(targetElement, diffString, configuration);
            diff2htmlUi.draw();
            diff2htmlUi.highlightCode();
        });
    </script>
</body>
</html>
    